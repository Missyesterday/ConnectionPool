# MySQL数据库连接池

## 1. 关键技术点：

- MySQL数据库编程
- 单例模式
- `queue`队列容器
- C++11多线程编程
- 线程互斥
- 线程同步通信
- `unique_lock`
- 基于CAS原子整型
- 智能指针`shared_ptr`
- lambda表达式
- 生产者-消费者模型

## 2. 连接池功能介绍

连接池一般包含了数据库连接所用的ip地址、port端口号、用户名和密码以及其他的性能参数，例如初始连接量，最大连接量，最大空闲时间、连接超时时间等。该项目是基于C++语言实现的连接池，主要实现以以下功能：

1.   **初始连接量（initSize）：**表示连接池事先会和MySQL Server创建initSize个数的connection连接，当应用发起MySQL访问时，不用再创建和MySQL Server新的连接，直接从连接池中获取一个可用的连接就可以，使用完成后，并不去释放connection，而是把当前connection再归还到连接池中。
2.   **最大连接量（maxSize）：**当并发访问MySQL Server的请求增多时，初始连接量已经不够使用了，此时会根据新的请求数量去创建更多的连接给应用去使用，但是新创建的连接数量上限时maxSize，不能无限制地创建连接，因为每一个连接都会占用一个socket资源，一般连接池和服务器程序是部署在一台主机上的，如果连接池占用过多的socket资源，那么服务器就不能接收太多的客户请求了。当这些连接使用完成后，再次归还到连接池中来维护。
3.   **最大空闲时间（maxIdleTime）：**当访问MySQL的并发请求多了以后，连接池里面的连接数量会动态增加，上限是maxSize个，当这些连接用完后再次归还到连接池中。如果在指定的maxIdleTime里面，这些新增加的连接都没有被再次使用过，那么新增加的这些连接资源就要被回收掉，只需要保持初始连接量initSize个就可以了。
4.   **连接超时时间（connectionTimeout）：**当MySQL的并发请求过大，连接池中的连接数量已经到达maxSize了，而此时没有空闲的连接可供使用，那么此时应用从连接池获取连接无法成功，它通过阻塞的方式获取连接的时间如果超过connectionTimeout时间（不断尝试，而不是sleep），那么获取连接失败，无法访问数据库。